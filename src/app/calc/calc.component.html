<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<div class="flexbox">
<mat-card>
    <mat-card-content>
        <div class="container flexbox">
            <div>
                <form id="htmlData" [formGroup]="formCalc" >
                    <div class="flexbox">
                        <div><mat-card-title>CALCULADORA</mat-card-title></div>
                    </div>
                    <mat-card>
                        <div class="flexbox">
                            <div class="mat-select-big-width">
                                <label>Tipo de cálculo</label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="fcTipos" required>
                                        <!-- Nâo aparecer 6.899/81 -->
                                        <mat-option value="particular">Débitos / créditos entre particulares</mat-option>
                                        <mat-option value="tributado">Débitos da Fazenda Pública - tributários</mat-option>
                                        <!-- Aparecer todos os índices -->
                                        <mat-option value="Ntributado">Débitos da Fazenda Pública - não tributários</mat-option>
                                        <mat-option value="Ctributado">Créditos da Fazenda Pública</mat-option>
                                        <!-- Nâo aparecer 11.960/2009 -->
                                        <!--mat-option value="abatimentos">Abatimentos (desenvolvimento)</mat-option-->
                                        <!-- Incluir Calculos de Multa em Salarios minimos -->
                                        <mat-option value="Multa" disabled>Multa em Salários (em desenvolvimento)</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div [hidden]="formCalc.controls.fcTipos.value == 'abatimentos'">
                                <label>Índice de correção monetária</label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="fcIndiceLanca" required>
                                        <mat-option value="IPCA-E">IPCA-E</mat-option>
                                        <mat-option value="IGP-M">IGP-M</mat-option>
                                        <mat-option value="TR">TR</mat-option>
                                        <mat-option value="SELIC">SELIC</mat-option>
                                        <mat-option value="TJ11960" [hidden]="formCalc.controls.fcTipos.value == 'particular'" title="TJ/RJ LEI 11.960/2009 (ORTN-OTN-BTN- TR-UFIR-IPCA-E)">
                                            TJ/RJ LEI 11.960/2009 (ORTN-OTN-BTN- TR-UFIR-IPCA-E)</mat-option>
                                        <mat-option value="TJ899" [hidden]="formCalc.controls.fcTipos.value == 'tributado'">
                                            TJ/RJ LEI 6.899/81 (UFIR-RJ)</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flexbox" >
                            <div [hidden]="formCalc.controls.fcTipos.value != 'abatimentos'">
                                <label >Lançamento</label>
                                    <mat-hint *ngIf="dataSourceLanca.data.length == 0">Nenhum lançamento cadastrado</mat-hint >
                                <mat-form-field appearance="outline" *ngIf="dataSourceLanca.data.length > 0" >
                                    <mat-select formControlName="fcListaLancamento" style="width:100%;">
                                        <!-- Nâo aparecer 6.899/81 -->
                                        <mat-option *ngFor="let element of dataSourceLanca.data; let i = index" [value]="i">{{element.dtIni | date: 'dd/MM/yyyy'}} | {{element.principal  | currency:'BRL'}} ({{element.indice}}) </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flexbox">
                            <div>
                                <label for="valor">Valor</label>
                                <mat-form-field appearance="outline">
                                    <input formControlName="fcValorLanca" matInput currencyMask
                                        [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }" min=1 />
                                </mat-form-field>
                            </div>

                            <div class="flexbox">
                                <div>
                                    <label for="dataDeInicio">Data inicial</label>
                                    <mat-form-field appearance="outline">
                                    <input formControlName="fcDtIniLanca" matInput type="date" id="dataDeInicio"
                                        name="dataDeInicio" required/>
                                    </mat-form-field>
                                </div>
                                <div>
                                    <label for="dataDeTermino">Data do cálculo</label>
                                    <mat-form-field appearance="outline">
                                    <input formControlName="fcDtFimLanca" matInput type="date" [min]="formCalc.controls.fcDtIniLanca.value"  id="dataDeTermino"
                                        name="dataDeTermino" required/>
                                    </mat-form-field>
                                </div>
                                <!--placeholder="yyyy-MM-dd" min="2013-01-01" max="2013-12-31"-->
                            </div>
                        </div>
                    </mat-card>
                    <mat-card>
                        <div class="flexbox">
                            <div>
                                <label labelPlacement="top" for="fcJuros">Incidir juros</label>
                                <mat-slide-toggle color="warn" formControlName="fcJuros" (click)="this.formCalc.controls.fcIndiceJuros.setValue('codigo_civil');"></mat-slide-toggle>
                            </div>
                            <div *ngIf="formCalc.controls.fcJuros.value">
                                <label>Índice de juros</label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="fcIndiceJuros" required>
                                        <mat-option value="codigo_civil" title="Juros do Código Civil - Lei nº 10406/02 (6% a.a. até 10/01/2003 e 12% a.a. a partir de 10/01/2003 a.a.)">Juros do Código Civil - Lei nº 10406/02 (6% e 12% a.a.)</mat-option>
                                        <mat-option value="simples_6" (click)="this.formCalc.controls.fcTaxaJuros.setValue(6);">Juros Simples 6% a.a.</mat-option>
                                        <mat-option value="simples_12" (click)="this.formCalc.controls.fcTaxaJuros.setValue(12);">Juros Simples 12% a.a.</mat-option>
                                        <mat-option value="especificar">Especificar Taxa</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div *ngIf="formCalc.controls.fcJuros.value && formCalc.controls.fcIndiceJuros.value == 'codigo_civil'">
                                <mat-hint >Percentual de juros até 10/01/2003:<BR />  6% ao ano ou 0,5% ao mês.<BR /> Percentual de juros a partir de 10/01/2003:<BR />  12% ao ano ou 1% ao mês </mat-hint>
                            </div>
                            <div [hidden]="!formCalc.controls.fcJuros.value || formCalc.controls.fcIndiceJuros.value == 'codigo_civil'">
                                <label for="fcTaxaJuros">Taxa de juros</label>
                                <mat-form-field appearance="outline">
                                    <input formControlName="fcTaxaJuros" matInput currencyMask
                                        [options]="{ prefix: '', suffix: '% a.a.', thousands: '.', decimal: ',' }" min=1 placeholder="0.12" />
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="flexbox" *ngIf="formCalc.controls.fcJuros.value">
                            <div>
                                <label for="fcDtIniJuros">Data de início dos juros</label>
                                <mat-form-field appearance="outline">
                                <input formControlName="fcDtIniJuros" matInput type="date" id="fcDtIniJuros"
                                    name="fcDtIniJuros" required/>
                                </mat-form-field>
                            </div>
                            <div>
                                <label for="fcDtFimJuros">Aplicar juros até </label>
                                <mat-form-field appearance="outline">
                                <input formControlName="fcDtFimJuros" matInput type="date" id="fcDtFimJuros"
                                    name="fcDtFimJuros" required/>
                                </mat-form-field>
                            </div>
                            <div>
                                <button	type="button" mat-raised-button color="warn"  (click)="setJuros()" 
                                    >Juros <mat-icon>add_circle</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="flexbox" *ngIf="formCalc.controls.fcJuros.value && dataTableJuros.length > 0">
                            <table class="table">
                                <thead>
                                    <th class="mat-header-cell cdk-header-cell">Data inicio</th>
                                    <th class="mat-header-cell cdk-header-cell">Data fim</th>
                                    <th class="mat-header-cell cdk-header-cell">Taxa</th>
                                </thead>
                                <tbody *ngFor="let element of dataTableJuros; let i = index">
                                <tr>
                                    <td class="mat-cell cdk-cell">{{element.dtIni | date: 'dd/MM/yyyy'}}</td>
                                    <td class="mat-cell cdk-cell">{{element.dtFim | date: 'dd/MM/yyyy'}}</td>
                                    <td class="mat-cell cdk-cell">{{element.taxa || element.indice}}% a.a.</td>
                                    <td class="mat-cell cdk-cell"><img src="/assets/imgs/icon_delete.svg" class="iconDeleteTab"
                                title="Clique para excluir" (click)="this.removeRowJuros(i)"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </mat-card>
                    <!--mat-card>
                        <div class="flexbox">
                            <div>
                                <label labelPlacement="top" for="fcAbatimentos">Incluir abatimento</label>
                                <mat-slide-toggle color="warn" formControlName="fcAbatimentos"></mat-slide-toggle>
                            </div>
                            <div *ngIf="formCalc.controls.fcAbatimentos.value">
                                <label for="fcDtAbatimento">Data do abatimento</label>
                                <mat-form-field appearance="outline">
                                <input formControlName="fcDtAbatimento" matInput type="date" id="fcDtAbatimento"
                                    name="fcDtAbatimento" required/>
                                </mat-form-field>
                            </div>
                            <div  *ngIf="formCalc.controls.fcAbatimentos.value">
                                <label for="fcValorAbatimento">Valor do abatimento</label>
                                <mat-form-field appearance="outline">
                                    <input formControlName="fcValorAbatimento" matInput currencyMask
                                        [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }" min=1 />
                                </mat-form-field>
                            </div>
                            <div  *ngIf="formCalc.controls.fcAbatimentos.value">
                                <button	type="button" mat-raised-button color="warn"  (click)="setAbatimento()" 
                                    >Abatimento <mat-icon>attach_money</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="flexbox" *ngIf="formCalc.controls.fcAbatimentos.value && dataTableAbatimentos.length > 0">
                            <table class="table">
                                <thead class="">
                                    <th class="mat-header-cell cdk-header-cell">Data</th>
                                    <th class="mat-header-cell cdk-header-cell">Valor</th>
                                </thead>
                                <tbody *ngFor="let element of dataTableAbatimentos; let i = index">
                                <tr>
                                    <td class="mat-cell cdk-cell">{{element.data | date: 'dd/MM/yyyy'}}</td>
                                    <td class="mat-cell cdk-cell">{{element.valor | currency :'BRL'}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </mat-card-->
                </form>
            </div>
            <mat-card class="ui-overlaypanel">
                <div class="flexbox">
                    <mat-icon>
                        tips_and_updates 
                    </mat-icon>
                    <mat-card-subtitle>
                        <label>Orientações de preenchimento</label>
                    </mat-card-subtitle>
                </div>
                    <div class="separator"></div>
                    <div class="scrolling">
                        <p>
                        Lançamentos de crédito correspondem a valores de decisões judiciais, custas, despesas etc que eventualmente podem
                        ser corrigidas por um determinado período de tempo.
                        </p>
                        <ul>
                            <li>Todos os valores estão em Reais (R$)</li>
                            <li>A presente calculadora virtual não substitui o cálculo realizado e homologado judicialmente.</li>
                        </ul>
                        <p>Os calculos realizados seguem as definições disponíveis na diretriz técnica abaixo relacionada.</p>
                        <a href="https://gateprodata.mprj.mp.br/gate/api/Cidadao/downloadPDF/27618" tabindex="-1">DIRETRIZ TÉCNICA nº 010/2020 - MPRJ 2019.00273069 </a>
                    </div>
            </mat-card>
        </div>
        <div class="container flexbox">
            <div>
                <button	type="submit" mat-raised-button color="warn"  (click)="addTbl()" [disabled]="!formCalc.valid"
                    >Calcular <mat-icon>calculate</mat-icon>
                </button>
            </div>
            <div>
                <button mat-raised-button color="primary" style="background-color: #00afaa;" (click)="isActive = !isActive" [hidden]="dataSourceLanca.data.length == 0">Memória de cálculo
                    <mat-icon>visibility</mat-icon>
                </button>
            </div>
            <div>
                <button mat-raised-button color="primary" style="background-color: #198cbb;" (click)="downloadAsPDF()" [hidden]="dataSourceLanca.data.length == 0">Relatório
                    <mat-icon>print</mat-icon>
                </button>
            </div>
        </div>
        <div class="container">
            <div class="">
            <!-- INCLUIR INDICE NA TABELA -->
                <mat-table #table [dataSource]="dataSourceLanca" class="mat-elevation-z8">
                    <ng-container matColumnDef="select" class="coluna">
                        <mat-header-cell *matHeaderCellDef>
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row"> </mat-cell>
                        <mat-footer-cell *matFooterCellDef style="font-weight: bold;">Total</mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="delete" class="coluna">
                        <mat-header-cell *matHeaderCellDef class="coluna">Excluir
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row; let i = index">
                            <img src="/assets/imgs/icon_delete.svg" class="iconDeleteTab"
                                title="Clique para excluir" (click)="this.removeRow(i)">
                        </mat-cell>
                        <mat-footer-cell *matFooterCellDef class="footerBold"></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="position" class="coluna">
                        <mat-header-cell *matHeaderCellDef class="coluna"> Nº
                        </mat-header-cell>
                        <mat-cell *matCellDef="let element; let i = index"> {{i + 1}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="indice">
                        <mat-header-cell *matHeaderCellDef> Índice de correção monetária</mat-header-cell>
                        <mat-cell *matCellDef="let element">{{element.fatorAplicado | number:'1.0-8'}} <br/>({{element.indice}}) </mat-cell>
                        <mat-footer-cell *matFooterCellDef class="footerBold"></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="valorAtualizado">
                        <mat-header-cell *matHeaderCellDef> Valor atualizado</mat-header-cell>
                        <mat-cell *matCellDef="let element">{{element.valorAtualizado | currency:'BRL'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef class="footerBold"></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="dtIni">
                        <mat-header-cell *matHeaderCellDef> Data inicial </mat-header-cell>
                        <mat-cell *matCellDef="let element"> {{element.dtIni | date: 'dd/MM/yyyy'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="principal">
                        <mat-header-cell *matHeaderCellDef> Valor principal</mat-header-cell>
                        <mat-cell *matCellDef="let element">
                            {{element.principal | currency:'BRL'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef style="font-weight: 700;">
                            {{this.SumTotal | currency:'BRL'}}</mat-footer-cell>
                    </ng-container>
                    
                    <ng-container matColumnDef="dtFim">
                        <mat-header-cell *matHeaderCellDef> Data do cálculo </mat-header-cell>
                        <mat-cell *matCellDef="let element"> {{element.dtFim | date: 'dd/MM/yyyy'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="dias">
                        <mat-header-cell *matHeaderCellDef> Período de Juros </mat-header-cell>
                        <mat-cell *matCellDef="let element"> {{element.jurosDiasTotal}} Dias</mat-cell>
                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                    </ng-container>

                    <ng-container matColumnDef="jurosValorTotal">
                        <mat-header-cell *matHeaderCellDef> Juros </mat-header-cell>
                        <mat-cell *matCellDef="let element">
                            {{element.jurosValorTotal| currency:'BRL'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef></mat-footer-cell>
                    </ng-container>
                    <ng-container matColumnDef="valorCorr">
                        <mat-header-cell *matHeaderCellDef> Total devido</mat-header-cell>
                        <mat-cell *matCellDef="let element;">
                            {{element.valorCorr | currency:'BRL'}} </mat-cell>
                        <mat-footer-cell *matFooterCellDef style="font-weight: 700;">
                            {{this.SumTotalCorr  | currency:'BRL'}}</mat-footer-cell>
                    </ng-container>
                    <ng-container matColumnDef="noData">
                        <mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumnsLanc.length">
                            Nenhum lançamento cadastrado.
                        </mat-footer-cell>
                    </ng-container>
                    <ng-container matColumnDef="check" class="coluna">
                        <mat-header-cell *matHeaderCellDef class="coluna">
                        </mat-header-cell>
                        <mat-cell *matCellDef="let element">
                            <mat-icon class="iconValidTab" *ngIf="element.position > 0">done
                            </mat-icon>
                        </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="displayedColumnsLanc; sticky: true"></mat-header-row>
                    <mat-footer-row
                        *matFooterRowDef="this.displayedColumnsLanc; sticky: false">
                    </mat-footer-row>
                    <mat-footer-row *matFooterRowDef="['noData']"
                        [hidden]="dataSourceLanca && dataSourceLanca.data.length > 0"></mat-footer-row>

                    <mat-row *matRowDef="let row; columns: displayedColumnsLanc;" >
                    </mat-row>
                </mat-table>
                <div clas="flexbox" [hidden]="!isActive">
                    <table class="table table-bordered" style="text-align: center;">                   
                        <tr class="table-primary">
                            <td>Nº</td>
                            <td>Data</td>
                            <td>Índice</td>                        
                            <td>Valor Índice (%)</td>
                            <td>Valor de correção</td>
                            <td>Valor de correção <br> acumulado </td>
                            <td>Valor Corrigido </td>
                        </tr>
                            <ng-container *ngFor="let element of dataSourceLanca.data; let i = index">
                                <tr *ngFor="let detalhamento of element.memoria" style="text-align: center;">
                                    <td>{{i+1}}</td>
                                    <td>{{detalhamento.data | date: 'dd/MM/yyyy'}}</td>
                                    <td>{{element.indice}}</td>                        
                                    <td style="text-align: center;">{{detalhamento.valorIndice | number:'1.0-8' }}</td>
                                    <td >{{detalhamento.valorCorrecao | number:'1.0-2'}}</td>
                                    <td >{{detalhamento.valorCorrecaoAcumulado | number:'1.0-2'}}</td>
                                    <td>{{detalhamento.result | currency:'BRL'}}</td>
                                </tr>
                            </ng-container>
                    </table>
                </div>
            </div>
        </div>
        <div class="container print-only">
            <div class="col-md-8" id="pdfTable" #pdfTable>
                <div>
                    <h2>Ministério Público do Estado do Rio de Janeiro</h2>
                    <h2>GATE - Grupo de Apoio Técnico Especializado</h2>
                    <p>{{ dataHoje | date:'longDate'}}.</p>
                </div>
                <h5 style="font-weight: bold;">
                    Lançamentos
                </h5>
                <br/>
                <ul style="list-style-type:none;">
                    <li *ngFor="let element of dados; let i = index" >
                        <b>{{i + 1}} - {{element.indice}}  de {{element.dtIni | date: 'dd/MM/yyyy'}} até {{element.dtFim | date: 'dd/MM/yyyy'}} </b>
                            <p>
                                Valor Principal: {{element.principal | currency:'BRL'}}<br/>
                                Juros: {{element.jurosValorTotal | currency:'BRL'}}<br/>
                                Valor Corrigido: {{element.valorCorr | currency:'BRL'}}
                            </p>
                    </li>                    
                </ul>   
                <br>
                <div  style="margin-top: 29cm;">
                    <h5 style="font-weight: bold;">
                        Memoria de Cálculo
                    </h5>
                </div>
                <br>
                <table class="table table-bordered" style="text-align: center;">                   
                    <tr class="table-primary">
                        <td>Nº</td>
                        <td>Data</td>
                        <td>Índice</td>                        
                        <td>Valor Índice (%)</td>
                        <td>Valor de correção</td>
                        <td>Valor de correção <br> acumulado </td>
                        <td>Valor Corrigido </td>
                    </tr>
                        <ng-container *ngFor="let element of dataSourceLanca.data; let i = index">
                            <tr *ngFor="let detalhamento of element.memoria" style="text-align: center;">
                                <td>{{i+1}}</td>
                                <td>{{detalhamento.data | date: 'dd/MM/yyyy'}}</td>
                                <td>{{element.indice}}</td>                        
                                <td style="text-align: center;">{{detalhamento.valorIndice | number:'1.0-8' }}</td>
                                <td >{{detalhamento.valorCorrecao | number:'1.0-2'}}</td>
                                <td >{{detalhamento.valorCorrecaoAcumulado | number:'1.0-2'}}</td>
                                <td>{{detalhamento.result | currency:'BRL'}}</td>
                            </tr>
                        </ng-container>
                </table>
            </div>
        </div>
    </mat-card-content>
</mat-card>
</div>