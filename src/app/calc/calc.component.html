<p>
  Todos os valores estão em Reais (R$) A presente calculadora virtual não
  substitui o cálculo realizado e homologado judicialmente.
</p>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<div class="flexbox">
  <div>
    <mat-card-content>
      <div class="container flexbox" (keydown.enter)="setLancamento()">
        <div>
          <form id="htmlData" [formGroup]="formCalc">
            <div class="flexbox">
              <div>
                <mat-card-title></mat-card-title>
                <input type="hidden" formControlName="fcIndex" />
              </div>
            </div>
            <mat-card>
              <div class="flexbox">
                <div class="mat-select-big-width">
                  <label>Tipo de cálculo</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="fcTipoCalculo" required autofocus>
                      <!-- Nâo aparecer 6.899/81 -->
                      <mat-option
                        value="particular"
                        (click)="
                          this.formCalc.controls.fcIndiceLanca.setValue('TJ6899')
                        "
                        >Créditos / Débitos Entre Particulares</mat-option
                      >
                      <mat-option
                        value="Ctributado"
                        (click)="
                          this.formCalc.controls.fcIndiceLanca.setValue('TJ6899')
                        "
                        >Créditos da Fazenda Pública</mat-option
                      >
                      <mat-option
                        value="tributado"
                        (click)="
                          this.formCalc.controls.fcIndiceLanca.setValue('SELIC')
                        "
                        >Débitos da Fazenda Pública - Tributários</mat-option
                      >
                      <!-- Aparecer todos os índices -->
                      <mat-option
                        value="Ntributado"
                        (click)="
                          this.formCalc.controls.fcIndiceLanca.setValue(
                            'TJ11960'
                          )
                        "
                        >Débitos da Fazenda Pública - Não
                        Tributários</mat-option
                      >
                      <!-- Nâo aparecer 11.960/2009 
                      <mat-option value="abatimentos" disabled
                        >Abatimentos (em desenvolvimento)</mat-option
                      >-->
                      <!-- Incluir Calculos de Precatórios -->
                      <mat-option value="precatorios"
                        >Precatórios - Tributários</mat-option
                      >
                      <mat-option value="precatorios"
                        >Precatórios - Não Tributários</mat-option
                      >
                      <!-- Incluir Calculos de Multa em Salarios minimos 
                      <mat-option value="Multa" disabled
                        >Multa em Salários</mat-option
                      >-->
                    </mat-select>
                  </mat-form-field>
                </div>
                <div
                  [hidden]="formCalc.controls.fcTipoCalculo.value == 'abatimentos'"
                >
                  <label>Índice de correção monetária</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="fcIndiceLanca" required>
                      <mat-option value="IPCA-E">IPCA-E</mat-option>
                      <mat-option value="IGP-M">IGP-M</mat-option>
                      <mat-option value="TR">TR</mat-option>
                      <mat-option value="INPC">INPC</mat-option>
                      <mat-option value="IGP-DI">IGP-DI</mat-option>
                      <mat-option value="IPCA">IPCA</mat-option>
                      <mat-option value="IPC-BR">IPC-BR</mat-option>
                      <mat-option value="CDI">CDI</mat-option>
                      <mat-option
                        value="SELIC"
                        (click)="this.formCalc.controls.fcJuros.setValue(false)"
                        >SELIC</mat-option
                      >
                      <mat-option
                        value="TJ11960"
                        [hidden]="
                          formCalc.controls.fcTipoCalculo.value == 'particular'
                        "
                        title="TJ/RJ LEI 11.960/2009 (ORTN-OTN-BTN- TR-UFIR-IPCA-E)"
                      >
                        TJ/RJ LEI 11.960/2009 (ORTN-OTN-BTN-
                        TR-UFIR-IPCA-E)</mat-option
                      >
                      <mat-option
                        value="TJ6899"
                        [hidden]="
                          formCalc.controls.fcTipoCalculo.value == 'tributado'
                        "
                      >
                        TJ/RJ LEI 6.899/81 (UFIR-RJ)</mat-option
                      >
                      <mat-option value="sem-correcao">
                        SEM CORREÇÃO MONETÁRIA</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div class="flexbox">
                <div
                  [hidden]="formCalc.controls.fcTipoCalculo.value != 'abatimentos'"
                >
                  <label>Lançamento</label>
                  <mat-hint *ngIf="dataSourceLanca.data.length == 0"
                    >Nenhum lançamento cadastrado</mat-hint
                  >
                  <mat-form-field
                    appearance="outline"
                    *ngIf="dataSourceLanca.data.length > 0"
                  >
                    <mat-select
                      formControlName="fcListaLancamento"
                      style="width: 100%"
                    >
                      <!-- Nâo aparecer 6.899/81 -->
                      <mat-option
                        *ngFor="
                          let element of dataSourceLanca.data;
                          let i = index
                        "
                        [value]="i"
                        >{{ element.dtIni | date: "dd/MM/yyyy" }} |
                        {{ element.principal | currency: "BRL" }} ({{
                          element.indice
                        }})
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div class="flexbox">
                <div>
                  <label for="valor">Valor</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcValorLanca"
                      matInput
                      currencyMask
                      [options]="{
                        prefix: 'R$ ',
                        thousands: '.',
                        decimal: ','
                      }"
                      min="1"
                      #valorLanca
                    />
                  </mat-form-field>
                </div>

                <div class="flexbox">
                  <div>
                    <label for="dataDeInicio">Data inicial</label>
                    <mat-form-field appearance="outline">
                      <input
                        formControlName="fcDtIniLanca"
                        matInput
                        type="date"
                        id="dataDeInicio"
                        name="dataDeInicio"
                        required
                        max="2999-12-31"
                        (change)="this.formCalc.controls.fcDtIniJuros.setValue(this.formCalc.controls.fcDtIniLanca.value)"
                      />
                    </mat-form-field>
                  </div>
                  <div>
                    <label for="dataDeTermino">Data do cálculo</label>
                    <mat-form-field appearance="outline">
                      <input
                        formControlName="fcDtFimLanca"
                        matInput
                        type="date"
                        [min]="formCalc.controls.fcDtIniLanca.value"
                        id="dataDeTermino"
                        name="dataDeTermino"
                        required
                        max="2999-12-31"
                        (change)="this.formCalc.controls.fcDtFimJuros.setValue(this.formCalc.controls.fcDtFimLanca.value);"
                      />
                    </mat-form-field>
                  </div>
                  <!--placeholder="yyyy-MM-dd" min="2013-01-01" max="2013-12-31"-->
                </div>
              </div>
              <div class="flexbox">
                <div class="mat-select-big-width">
                  <label for="descricao">Descrição</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="fcDescricao">
                      <mat-option value="Ressarcimento"
                        >Ressarcimento</mat-option
                      >
                      <mat-option value="Ressarcimento ao erário"
                        >Ressarcimento ao erário</mat-option
                      >
                      <mat-option value="Débitos da Fazenda Pública"
                        >Débitos da Fazenda Pública</mat-option
                      >
                      <mat-option value="Multa Civil">Multa Civil</mat-option>
                      <mat-option value="Honorários advocatícios"
                        >Honorários advocatícios</mat-option
                      >
                      <mat-option value="Outros">Outros</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div [hidden]="formCalc.controls.fcDescricao.value != 'Outros'">
                  <label>Especifique uma descrição</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcDescricaoOutros"
                      matInput
                      type="text"
                      placeholder="Multa administrativa"
                      maxlength="100"
                    />
                  </mat-form-field>
                </div>
              </div>
            </mat-card>
            <mat-card>
              <div class="flexbox">
                <div>
                  <label labelPlacement="top" for="fcJuros"
                    >Incidir juros?</label
                  >
                  <mat-slide-toggle
                    color="warn"
                    formControlName="fcJuros"
                    [disabled]="formCalc.controls.fcIndiceLanca.value === 'SELIC'"
                  ></mat-slide-toggle>
                    <!--mat-slide-toggle
                    color="warn"
                    formControlName="fcJuros"
                    (click)="this.enableJuros();"
                    [disabled]="!formCalc.valid || formCalc.controls.fcIndiceLanca.value === 'SELIC'"
                  ></mat-slide-toggle-->
                </div>
                <div *ngIf="formCalc.controls.fcJuros.value">
                  <label>Índice de juros</label>
                  <mat-form-field appearance="outline">
                    <mat-select formControlName="fcIndiceJuros" required>
                      <mat-option
                        value="codigo_civil"
                        title="Juros do Código Civil - Lei nº 10406/02 (6% a.a. até 10/01/2003 e 12% a.a. a partir de 10/01/2003 a.a.)"
                        >Juros do Código Civil - Lei nº 10406/02 (6% e 12%
                        a.a.)</mat-option
                      >
                      <mat-option
                        value="especificar"
                        (click)="this.formCalc.controls.fcTaxaJuros.setValue(6)"
                        >Juros Simples 6% a.a.</mat-option
                      >
                      <mat-option
                        value="especificar"
                        (click)="
                          this.formCalc.controls.fcTaxaJuros.setValue(12)
                        "
                        >Juros Simples 12% a.a.</mat-option
                      >
                      <mat-option value="SELIC">SELIC</mat-option>
                      <mat-option
                        value="poupanca"
                        (click)="this.formCalc.controls.fcTaxaJuros.setValue(1)"
                        >Poupança (Antiga + Nova)</mat-option
                      >
                      <mat-option
                        value="POUPANTIGA"
                        (click)="this.formCalc.controls.fcTaxaJuros.setValue(1)"
                        >Poupança Antiga</mat-option
                      >
                      <mat-option
                        value="POUPNOVA"
                        (click)="this.formCalc.controls.fcTaxaJuros.setValue(1)"
                        >Poupança Nova</mat-option
                      >
                      <mat-option value="especificar"
                        >Especificar Taxa</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div
                  *ngIf="
                    formCalc.controls.fcJuros.value &&
                    formCalc.controls.fcIndiceJuros.value == 'codigo_civil'
                  "
                >
                  <mat-hint
                    >Percentual de juros até 10/01/2003:<BR /> 6% ao ano ou 0,5%
                    ao mês.<BR /> Percentual de juros a partir de 11/01/2003:<BR />
                    12% ao ano ou 1% ao mês
                  </mat-hint>
                </div>
                <div
                  *ngIf="
                    formCalc.controls.fcJuros.value &&
                    formCalc.controls.fcIndiceJuros.value == 'poupanca'
                  "
                >
                  <mat-hint
                    >Caderneta de poupança:<BR />
                    Poupança Antiga e Poupança Atual a partir de 03/05/2012
                  </mat-hint>
                </div>
                <div *ngIf="formCalc.controls.fcIndiceLanca.value === 'SELIC'">
                  <mat-hint
                    >SELIC já engloba juros e correção monetária. <BR /> Com sua
                    incidência fica vedada a cumulação com quaisquer outros
                    índices. <BR />
                  </mat-hint>
                </div>
                <div
                  [hidden]="
                    !formCalc.controls.fcJuros.value ||
                    formCalc.controls.fcIndiceJuros.value == 'codigo_civil' ||
                    formCalc.controls.fcIndiceJuros.value != 'especificar'
                  "
                >
                  <label for="fcTaxaJuros">Taxa de juros</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcTaxaJuros"
                      matInput
                      currencyMask
                      [options]="{
                        prefix: '',
                        suffix: '% a.a.',
                        thousands: '.',
                        decimal: ','
                      }"
                      min="1"
                      placeholder="0.12"
                    />
                  </mat-form-field>
                </div>
              </div>
              <div class="flexbox" *ngIf="formCalc.controls.fcJuros.value">
                <div>
                  <label for="fcDtIniJuros">Data de início dos juros</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcDtIniJuros"
                      matInput
                      type="date"
                      id="fcDtIniJuros"
                      name="fcDtIniJuros"
                      required
                      max="2999-12-31"
                    />
                  </mat-form-field>
                </div>
                <div>
                  <label for="fcDtFimJuros">Aplicar juros até </label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcDtFimJuros"
                      matInput
                      type="date"
                      id="fcDtFimJuros"
                      name="fcDtFimJuros"
                      required
                      max="2999-12-31"
                    />
                  </mat-form-field>
                </div>
                <div class="align-self-center">
                  <button
                    type="button"
                    mat-stroked-button
                    color="primary"
                    (click)="setJuros()"
                  >
                    APLICAR JUROS
                    <!--mat-icon>add_circle</mat-icon-->
                  </button>
                </div>
              </div>
              <div
                class="flexbox"
                *ngIf="
                  formCalc.controls.fcJuros.value &&
                  dataSourceJuros.data.length > 0
                "
              >
                <table class="table table-bordered">
                  <thead>
                    <th class="mat-header-cell cdk-header-cell">Data Inicio</th>
                    <th class="mat-header-cell cdk-header-cell">Data Fim</th>
                    <th class="mat-header-cell cdk-header-cell">Dias</th>
                    <th class="mat-header-cell cdk-header-cell">Taxa</th>
                    <th class="mat-header-cell cdk-header-cell">% Acumulado</th>
                  </thead>
                  <tbody
                    *ngFor="let element of dataSourceJuros.data; let i = index"
                  >
                    <tr>
                      <td class="mat-cell cdk-cell">
                        {{ element.dtIni | date: "dd/MM/yyyy" }}
                      </td>
                      <td class="mat-cell cdk-cell">
                        {{ element.dtFim | date: "dd/MM/yyyy" }}
                      </td>
                      <td class="mat-cell cdk-cell">
                        {{ element.dias }}
                      </td>
                      <td class="mat-cell cdk-cell">
                        {{
                          element.taxa * 100
                            | number: "1.0-8" || element.indice
                        }}% a.a.
                      </td>
                      <td class="mat-cell cdk-cell">
                        {{
                          element.taxaAcumulada * 100
                            | number: "1.0-8" || element.indice
                        }}%
                      </td>
                      <td class="mat-cell cdk-cell">
                        <img
                          src="/assets/svgs/trash-alt-regular.svg"
                          class="iconDeleteTab"
                          title="Excluir juros"
                          (click)="this.removeRowJuros(i)"
                        />
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </mat-card>
            <!--Abatimentos
            <mat-card>
              <div class="flexbox">
                <div>
                  <label labelPlacement="top" for="fcAbatimentos"
                    >Abatimentos?</label
                  >
                  <mat-slide-toggle
                    color="warn"
                    formControlName="fcAbatimentos"
                  ></mat-slide-toggle>
                </div>
                <div *ngIf="formCalc.controls.fcAbatimentos.value">
                  <label for="fcDtAbatimento">Data do abatimento</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcDtAbatimento"
                      matInput
                      type="date"
                      id="fcDtAbatimento"
                      name="fcDtAbatimento"
                      required
                    />
                  </mat-form-field>
                </div>
                <div *ngIf="formCalc.controls.fcAbatimentos.value">
                  <label for="fcValorAbatimento">Valor do abatimento</label>
                  <mat-form-field appearance="outline">
                    <input
                      formControlName="fcValorAbatimento"
                      matInput
                      currencyMask
                      [options]="{
                        prefix: 'R$ ',
                        thousands: '.',
                        decimal: ','
                      }"
                      min="1"
                    />
                  </mat-form-field>
                </div>
                <div *ngIf="formCalc.controls.fcAbatimentos.value">
                  <button
                    type="button"
                    mat-raised-button
                    color="warn"
                    (click)="setAbatimento()"
                  >
                    Abatimento <mat-icon>attach_money</mat-icon>
                  </button>
                </div>
              </div>
              <div
                class="flexbox"
                *ngIf="
                  formCalc.controls.fcAbatimentos.value &&
                  dataTableAbatimentos.length > 0
                "
              >
                <table class="table">
                  <thead class="">
                    <th class="mat-header-cell cdk-header-cell">Data</th>
                    <th class="mat-header-cell cdk-header-cell">Valor</th>
                  </thead>
                  <tbody
                    *ngFor="let element of dataTableAbatimentos; let i = index"
                  >
                    <tr>
                      <td class="mat-cell cdk-cell">
                        {{ element.data | date: "dd/MM/yyyy" }}
                      </td>
                      <td class="mat-cell cdk-cell">
                        {{ element.valor | currency: "BRL" }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </mat-card>-->
          </form>
          <div>
            <button
              type="submit"
              mat-raised-button
              (click)="setLancamento()"
              [disabled]="!formCalc.valid"
              class="btn-calc"
            >
              {{formCalc.controls.fcIndex.value === '' ? 'CALCULAR' : 'RECALCULAR'}}
            </button>
            <button
            type="submit"
            mat-stroked-button
            color="primary"
            (click)="clearForm()"
            class="btn-cancel"
          >
            {{formCalc.controls.fcIndex.value === '' ? 'LIMPAR' : 'CANCELAR'}}
          </button>
          </div>
        </div>
        <div>
          <mat-card class="ui-overlaypanel">
            <div class="flexbox">
              <mat-card-subtitle>
                <label>Histórico de cálculos</label>
              </mat-card-subtitle>
            </div>
            <div class="separator"></div>
            <div class="scrolling">
              <table class="table table-bordered" style="text-align: center">
                <thead class="table-primary" align="center" valign="middle">
                  <tr>
                    <th>#</th>
                    <th class="mat-header-cell cdk-header-cell">
                      Data inicial
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Valor principal
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Total devido
                    </th>
                  </tr>
                </thead>
                <tbody
                  *ngFor="let element of dataSourceLanca.data; let i = index"
                >
                  <tr>
                    <td>{{ i + 1 }}. <br />{{ element.descricao }}</td>
                    <td>
                      {{ element.dtIni | date: "dd/MM/yyyy" }}
                    </td>
                    <td>{{ element.principal | currency: "BRL":"":"" }}</td>
                    <td>{{ element.valorCorr | currency: "BRL":"":"" }}</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th>{{ this.sumTotal | currency: "BRL":"":"" }}</th>
                    <th>{{ this.sumTotalCorr | currency: "BRL":"":"" }}</th>
                  </tr>
                </tfoot>
              </table>
            </div>
          </mat-card>
          <div>
            <p>
              Lançamentos de crédito correspondem a valores de decisões
              judiciais, custas, despesas etc que eventualmente podem ser
              corrigidas por um determinado período de tempo.
            </p>
            <p>
              Os cálculos realizados devem seguir as definições disponíveis na
              <a
                href="https://gateprodata.mprj.mp.br/gate/api/Cidadao/downloadPDF/27618"
                tabindex="-1"
                >DIRETRIZ TÉCNICA nº 010/2020 - MPRJ 2019.00273069
              </a>
            </p>
          </div>
        </div>
      </div>
      <div class="container flexbox">
        <h2>Lançamentos</h2>
      </div>
      <div class="container flexbox">
        <div>
          <button
            mat-raised-button
            (click)="saveCalc()"
            [hidden]="dataSourceLanca.data.length == 0"
            [matMenuTriggerFor]="menu"
          >
            Relatório
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="makePDF('myPdfTable')">
              PDF
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAB1ElEQVRIic2VPUhbURTHf+8jGqJUq5YgRSXEIi1twKmCpYsELDa4iCgOLX6ATg5xcCnUXRxEwaWraOxQEDuJhZZSp1YRBFGMKPiFSFT8Cry8Dm8QE2zuTW6Df7jLuef8f5x7z30PciwtOWC3+7xY2gspF1vf1WY2VkVSzZRIgtdoRIRhpgt0M263+lq0SHQ2XboubHyX3AVYfSN5uD2f7VZf6P8DAdsfwOoVgyoBykCVAUWhSoFJ0IjdVl2bvJ86pbK6PMMY7kyNm3luri+qgT9qgZaFtr0mnC5/pGWP4c17eOiVLoVMOuwagmd18KQWRvuly+U7NF1wfgrFj6RLMwOuL0OJF/aiOQIuTIOdgB3xQckOaBiABsEOcOXnAFgfgs0VsIF3H6TL5abUdEFDO0wNw+EOfJwCbwUUFEFhsXOv42E4PVYEfNUMpeXQ1AWVNRBdhQelUPUUTo7geb3zZBa/Zgl0e+BtD4S6YXcTfnyBn7MQOwTdgJeN4A9A7Ah+L/zTKj3QH4CBCefLsr8FgyGIX93sJyz4NecsAaUfms4hBxa/grHwbVgGSt/h/CQcH8DcJ9hYygomBvw24yxFUv4DvnfA1CPV+Y5FUIm7wYoSn2z0F2ZCgXe+7E0BAAAAAElFTkSuQmCC"
              />
            </button>
            <button mat-menu-item (click)="getExcel()">
              XLS
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAACb0lEQVRIie2WT2gTQRTGv7ebhLZJSNvEWpoab61IIF7EWulRKKKISPGqSKkHhaIiXgpiRQ9qKKhgETzEg+DBixSh0F4qhgr+gWIOVcHWJoK2jW3SpJvs7vMgiUnW/dOS6MF+pzfDN+83OzP7ZoAt/SWRFZNvpK9TFNQdRh5vsJPZ7tDNR1BSsZ7hactg390THYKixACIRr7mPbsXiKjdyENEp2M9Vx4CgGAGtuWVNjOoZakIFEJTcK30z8C2kpjcg91dKqnOUsP6UjIkuho0AwWHDSRufgeKYPeFff3M6mjlaZMza5Aza9qRRDmh0fO60Ewvfl+HSF+MYGQTUxowM7VtaMrMDlVR9heaiirHwfAbgvPyeCHW3WO/pwXbXE3FdqCpFZ5614bmZiRd8Mmuo4hefIQGRx327gzizeUn2O721h4cnoxAyufQf+A4rh85h/BkBLPf5moPzuYlDI3dw1DvAFrczQhPRKoGBcp/J43q7XWQZAlEBCJtdXVG48VY8rnZtCoQuBDqWr3ORlw7fBYDj4exmE7i0sFTZknNLxz1t0f3i28eO4+55QTG3k/hRzaFZ2fu4Om7CcwkPpjmt6I/gokIV5+PIplZATPjxae3CN3ow2o2XRWoLpiZ8XkpXtY3v/y1atAyMBEnmC29C375FTUHULFk2tK5DNvFeUOYpK5owKnb0w/cg90zlZeEfTkfsqfztyqTCJLiIOJiyfR8TC0QwfghABovrFvpUnNq5GW00tzaG5QB1SjfpvT/PQRMwaIgJwBSqgFj4mKxt3SM/Yd2dcgKBYw8nnYfQxD184nK6uz9qVeWZ7mlaukn+qHDBVf59wAAAAAASUVORK5CYII="
              />
            </button>
          </mat-menu>
        </div>
        <!--div>
          <button
            mat-raised-button
            (click)="makePDF('myPdfTable')"
            [hidden]="dataSourceLanca.data.length == 0"
          >
            Relatório
            <img
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAB1ElEQVRIic2VPUhbURTHf+8jGqJUq5YgRSXEIi1twKmCpYsELDa4iCgOLX6ATg5xcCnUXRxEwaWraOxQEDuJhZZSp1YRBFGMKPiFSFT8Cry8Dm8QE2zuTW6Df7jLuef8f5x7z30PciwtOWC3+7xY2gspF1vf1WY2VkVSzZRIgtdoRIRhpgt0M263+lq0SHQ2XboubHyX3AVYfSN5uD2f7VZf6P8DAdsfwOoVgyoBykCVAUWhSoFJ0IjdVl2bvJ86pbK6PMMY7kyNm3luri+qgT9qgZaFtr0mnC5/pGWP4c17eOiVLoVMOuwagmd18KQWRvuly+U7NF1wfgrFj6RLMwOuL0OJF/aiOQIuTIOdgB3xQckOaBiABsEOcOXnAFgfgs0VsIF3H6TL5abUdEFDO0wNw+EOfJwCbwUUFEFhsXOv42E4PVYEfNUMpeXQ1AWVNRBdhQelUPUUTo7geb3zZBa/Zgl0e+BtD4S6YXcTfnyBn7MQOwTdgJeN4A9A7Ah+L/zTKj3QH4CBCefLsr8FgyGIX93sJyz4NecsAaUfms4hBxa/grHwbVgGSt/h/CQcH8DcJ9hYygomBvw24yxFUv4DvnfA1CPV+Y5FUIm7wYoSn2z0F2ZCgXe+7E0BAAAAAElFTkSuQmCC"
            />
          </button>
        </div>
        <div>
          <button
            type="submit"
            mat-raised-button
            (click)="saveCalc()"
            [hidden]="dataSourceLanca.data.length == 0"
          >
            Relatório
            <img
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAACb0lEQVRIie2WT2gTQRTGv7ebhLZJSNvEWpoab61IIF7EWulRKKKISPGqSKkHhaIiXgpiRQ9qKKhgETzEg+DBixSh0F4qhgr+gWIOVcHWJoK2jW3SpJvs7vMgiUnW/dOS6MF+pzfDN+83OzP7ZoAt/SWRFZNvpK9TFNQdRh5vsJPZ7tDNR1BSsZ7hactg390THYKixACIRr7mPbsXiKjdyENEp2M9Vx4CgGAGtuWVNjOoZakIFEJTcK30z8C2kpjcg91dKqnOUsP6UjIkuho0AwWHDSRufgeKYPeFff3M6mjlaZMza5Aza9qRRDmh0fO60Ewvfl+HSF+MYGQTUxowM7VtaMrMDlVR9heaiirHwfAbgvPyeCHW3WO/pwXbXE3FdqCpFZ5614bmZiRd8Mmuo4hefIQGRx327gzizeUn2O721h4cnoxAyufQf+A4rh85h/BkBLPf5moPzuYlDI3dw1DvAFrczQhPRKoGBcp/J43q7XWQZAlEBCJtdXVG48VY8rnZtCoQuBDqWr3ORlw7fBYDj4exmE7i0sFTZknNLxz1t0f3i28eO4+55QTG3k/hRzaFZ2fu4Om7CcwkPpjmt6I/gokIV5+PIplZATPjxae3CN3ow2o2XRWoLpiZ8XkpXtY3v/y1atAyMBEnmC29C375FTUHULFk2tK5DNvFeUOYpK5owKnb0w/cg90zlZeEfTkfsqfztyqTCJLiIOJiyfR8TC0QwfghABovrFvpUnNq5GW00tzaG5QB1SjfpvT/PQRMwaIgJwBSqgFj4mKxt3SM/Yd2dcgKBYw8nnYfQxD184nK6uz9qVeWZ7mlaukn+qHDBVf59wAAAAAASUVORK5CYII="
            />
          </button>
        </div>
        <div>
          <button
            mat-raised-button
            color="primary"
            style="background-color: #00afaa"
            (click)="isActive = !isActive"
            [hidden]="dataSourceLanca.data.length == 0"
          >
            Memória de cálculo
            <mat-icon>visibility</mat-icon>
          </button>
        </div>

        <div class="example-button-row">
          <button
            mat-raised-button
            (click)="alertDialog('Ops, you did it again!')"
          >
            Alert
          </button>
          <button
            mat-raised-button
            color="primary"
            (click)="confirmDialog('sure?', 'really!')"
          >
            Confirm
          </button>
          <button
            mat-raised-button
            color="accent"
            (click)="showReplicationPrompt('Replicar lançamento')"
          >
            Prompt Input
          </button>
          <h2 *ngIf="dataFromDialog">
            Data from mat-dialog : {{ dataFromDialog | json }}
          </h2>
        </div-->
      </div>
      <div class="container" id="Report">
        <div>
          <!-- INCLUIR INDICE NA TABELA -->
          <mat-table
            #table
            [dataSource]="dataSourceLanca"
            class="mat-elevation-z8"
            multiTemplateDataRows
          >
            <mat-header-row
              *matHeaderRowDef="displayedColumnsLanc; sticky: true"
            ></mat-header-row>

            <ng-container matColumnDef="select">
              <mat-header-cell *matHeaderCellDef> </mat-header-cell>
              <mat-cell *matCellDef="let row"> </mat-cell>
              <mat-footer-cell *matFooterCellDef style="font-weight: bold"
                >Total</mat-footer-cell
              >
            </ng-container>

            <ng-container matColumnDef="position">
              <mat-header-cell *matHeaderCellDef> # </mat-header-cell>
              <mat-cell *matCellDef="let element; let i = dataIndex">
                {{ i + 1 }}. <br />{{ element.descricao }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="dtIni">
              <mat-header-cell *matHeaderCellDef>
                Data inicial
              </mat-header-cell>
              <mat-cell *matCellDef="let element">
                {{ element.dtIni | date: "dd/MM/yyyy" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="principal">
              <mat-header-cell *matHeaderCellDef>
                Valor principal</mat-header-cell
              >
              <mat-cell *matCellDef="let element">
                {{ element.principal | currency: "BRL" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef class="footerBold">
                {{ this.sumTotal | currency: "BRL" }}</mat-footer-cell
              >
            </ng-container>

            <ng-container matColumnDef="dtFim">
              <mat-header-cell *matHeaderCellDef>
                Data do cálculo
              </mat-header-cell>
              <mat-cell *matCellDef="let element">
                {{ element.dtFim | date: "dd/MM/yyyy" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="indice">
              <mat-header-cell *matHeaderCellDef>
                Índice de correção monetária</mat-header-cell
              >
              <mat-cell *matCellDef="let element"
                >{{ element.fatorAplicado | number: "1.0-8" }} <br />({{
                  element.indice
                }})
              </mat-cell>
              <mat-footer-cell
                *matFooterCellDef
                class="footerBold"
              ></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="valorAtualizado">
              <mat-header-cell *matHeaderCellDef>
                Valor atualizado</mat-header-cell
              >
              <mat-cell *matCellDef="let element"
                >{{ element.valorAtualizado | currency: "BRL" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef class="footerBold">{{
                this.sumTotalAtualizado | currency: "BRL"
              }}</mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="dias">
              <mat-header-cell *matHeaderCellDef> Dias </mat-header-cell>
              <mat-cell *matCellDef="let element">
                {{ element.jurosDiasTotal }} Dias</mat-cell
              >
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="jurosValorTotal">
              <mat-header-cell *matHeaderCellDef> Juros </mat-header-cell>
              <mat-cell *matCellDef="let element">
                {{ element.jurosValorTotal | currency: "BRL" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef class="footerBold">{{
                this.sumTotalJuros | currency: "BRL"
              }}</mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="valorCorr">
              <mat-header-cell *matHeaderCellDef> Total devido</mat-header-cell>
              <mat-cell *matCellDef="let element">
                {{ element.valorCorr | currency: "BRL" }}
              </mat-cell>
              <mat-footer-cell *matFooterCellDef class="footerBold">
                {{ this.sumTotalCorr | currency: "BRL" }}</mat-footer-cell
              >
            </ng-container>

            <ng-container matColumnDef="delete">
              <mat-header-cell *matHeaderCellDef>
                <img
                  src="/assets/svgs/trash-alt-solid.svg"
                  class="iconDeleteTab"
                  title="Excluir todos"
                  (click)="this.removeAllRows(i)"
                  [hidden]="dataSourceLanca && dataSourceLanca.data.length < 1"
              /></mat-header-cell>
              <mat-cell *matCellDef="let row; let i = dataIndex">
                <img
                  src="/assets/svgs/pen-to-square-regular.svg"
                  class="iconDeleteTab"
                  title="Editar lançamento"
                  (click)="this.editRow(i)"
                />                     
                <img
                  src="/assets/svgs/clone-regular.svg"
                  class="iconClone"
                  title="Replicar lançamento"
                  (click)="showReplicationPrompt('Replicar Lançamento', i)"
                />
                <img
                  src="/assets/svgs/trash-alt-regular.svg"
                  class="iconDeleteTab"
                  title="Excluir lançamento"
                  (click)="this.removeRow(i)"
                />           
              </mat-cell>
              <mat-footer-cell
                *matFooterCellDef
                class="footerBold"
              ></mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="noData">
              <mat-footer-cell
                *matFooterCellDef
                [attr.colspan]="displayedColumnsLanc.length"
              >
                Calcule o primeiro lançamento.
              </mat-footer-cell>
            </ng-container>

            <ng-container matColumnDef="check">
              <mat-header-cell *matHeaderCellDef> </mat-header-cell>
              <mat-cell *matCellDef="let element">
                <mat-icon class="iconValidTab" *ngIf="element.position > 0"
                  >done
                </mat-icon>
              </mat-cell>
            </ng-container>

            <mat-footer-row
              *matFooterRowDef="this.displayedColumnsLanc; sticky: false"
            >
            </mat-footer-row>
            <mat-footer-row
              *matFooterRowDef="['noData']"
              [hidden]="dataSourceLanca && dataSourceLanca.data.length > 0"
            ></mat-footer-row>

            <mat-row
              *matRowDef="let row; columns: displayedColumnsLanc; let i = index"
            >
            </mat-row>
          </mat-table>
        </div>
        <div clas="flexbox" id="pdfTable" #pdfTable [hidden]="!isActive">
          <div [hidden]="true">
            <!--img alt="MPRJ Logo" src="/assets/imgs/LOGO_MPRJ_GATE.png" /-->
            <ng-container>
              <table
                id="myPdfTable"
                class="table table-bordered"
                style="text-align: center"
              >
                <thead class="table-primary" align="center" valign="middle">
                  <tr>
                    <th>#</th>
                    <th class="mat-header-cell cdk-header-cell">
                      Período de correção monetária
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Valor principal
                      <p>(R$)</p>
                    </th>
                    <!--th class="mat-header-cell cdk-header-cell">
                      Data do cálculo
                    </th-->
                    <th class="mat-header-cell cdk-header-cell">
                      Índice de correção monetária
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Valor Atualizado
                      <p>(R$)</p>
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Data Inicial de Juros
                    </th>
                    <th class="mat-header-cell cdk-header-cell">Dias</th>
                    <th class="mat-header-cell cdk-header-cell">
                      Juros
                      <p>(R$)</p>
                    </th>
                    <th class="mat-header-cell cdk-header-cell">
                      Total devido
                      <p>(R$)</p>
                    </th>
                  </tr>
                </thead>
                <tbody
                  *ngFor="let element of dataSourceLanca.data; let i = index"
                >
                  <tr>
                    <td>{{ i + 1 }}. <br />{{ element.descricao }}</td>
                    <td>
                      {{ element.dtIni | date: "dd/MM/yyyy" }} a
                      {{ element.dtFim | date: "dd/MM/yyyy" }}
                    </td>
                    <td>{{ element.principal | currency: "BRL":"":"" }}</td>
                    <!--td>{{ element.dtFim | date: "dd/MM/yyyy" }}</td-->
                    <td>
                      {{ element.fatorAplicado | number: "1.0-8" }} <br /><small
                        >({{ element.indice }})</small
                      >
                    </td>
                    <td>
                      {{ element.valorAtualizado | currency: "BRL":"":"" }}
                    </td>
                    <td>{{ element.juros[0]?.dtIni | date: "dd/MM/yyyy" }}</td>
                    <td>{{ element.jurosDiasTotal }}</td>
                    <td>
                      {{ element.jurosValorTotal | currency: "BRL":"":"" }}
                    </td>
                    <td>{{ element.valorCorr | currency: "BRL":"":"" }}</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th>{{ this.sumTotal | currency: "BRL":"":"" }}</th>
                    <th></th>
                    <th>
                      {{ this.sumTotalAtualizado | currency: "BRL":"":"" }}
                    </th>
                    <th></th>
                    <th></th>
                    <th>{{ this.sumTotalJuros | currency: "BRL":"":"" }}</th>
                    <th>{{ this.sumTotalCorr | currency: "BRL":"":"" }}</th>
                  </tr>
                </tfoot>
              </table>
            </ng-container>
          </div>
          <br />
          <ng-container
            *ngFor="let element of dataSourceLanca.data; let i = index"
          >
            <div *ngIf="element.juros.length > 0">
              <b>JUROS</b>
              <table class="table table-bordered" style="text-align: center">
                <thead>
                  <tr>
                    <th class="mat-header-cell cdk-header-cell">#</th>
                    <th class="mat-header-cell cdk-header-cell">
                      Valor Atualizado
                    </th>
                    <th class="mat-header-cell cdk-header-cell">Data Inicio</th>
                    <th class="mat-header-cell cdk-header-cell">Data Fim</th>
                    <th class="mat-header-cell cdk-header-cell">Dias</th>
                    <th class="mat-header-cell cdk-header-cell">Taxa</th>
                    <th class="mat-header-cell cdk-header-cell">% Acumulado</th>
                    <th class="mat-header-cell cdk-header-cell">Juros (R$)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let juros of element.juros; let j = index">
                    <td>{{ i + 1 }}</td>
                    <td>
                      {{ element.valorAtualizado | currency: "BRL":"":"" }}
                    </td>
                    <td>
                      {{ juros.dtIni | date: "dd/MM/yyyy" }}
                    </td>
                    <td>
                      {{ juros.dtFim | date: "dd/MM/yyyy" }}
                    </td>
                    <td>
                      {{ juros.dias }}
                    </td>
                    <td>{{ juros.taxa * 100 | number: "1.0-2" }} % a.a.</td>
                    <td>{{ juros.taxaAcumulada * 100 | number: "1.0-2" }} %</td>
                    <td>
                      {{ juros.valor | currency: "BRL":"":"" }}
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>{{ element.jurosDiasTotal }}</th>
                    <th></th>
                    <th></th>
                    <th>
                      {{ element.jurosValorTotal | currency: "BRL":"":"" }}
                    </th>
                  </tr>
                </tfoot>
              </table>
            </div>
            <mat-card *ngIf="isActive">
              <b>MEMÓRIA DE CÁLCULO</b>
              <table class="table table-bordered" style="text-align: center">
                <tr class="table-primary">
                  <!--td>Nº</td-->
                  <th class="mat-header-cell cdk-header-cell">Data</th>
                  <th class="mat-header-cell cdk-header-cell">
                    Valor Índice (%)
                  </th>
                  <th class="mat-header-cell cdk-header-cell">
                    Valor de correção
                  </th>
                  <th class="mat-header-cell cdk-header-cell">
                    Valor de correção <br />
                    acumulado
                  </th>
                  <th class="mat-header-cell cdk-header-cell">
                    Valor Corrigido
                  </th>
                </tr>
                <tr
                  *ngFor="let detalhamento of element.memoria"
                  style="text-align: center"
                >
                  <!--td>{{ i + 1 }}</td-->
                  <td>{{ detalhamento.data | date: "dd/MM/yyyy" }}</td>
                  <td style="text-align: center">
                    {{ detalhamento.valorIndice | number: "1.0-8" }}
                  </td>
                  <td>{{ detalhamento.valorCorrecao | number: "1.0-2" }}</td>
                  <td>
                    {{ detalhamento.valorCorrecaoAcumulado | number: "1.0-2" }}
                  </td>
                  <td>{{ detalhamento.result | currency: "BRL" }}</td>
                </tr>
              </table>
            </mat-card>
            <br />
          </ng-container>
        </div>
      </div>
    </mat-card-content>
  </div>
</div>
